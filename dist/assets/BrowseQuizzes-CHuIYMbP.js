import{a as _,h as F,r as t,j as e}from"./index-BbbxppCW.js";import{C as x}from"./card-zbz7qCJr.js";import{S as l}from"./skeleton-TmsLY8PM.js";import{B as w}from"./button-CIKh5vM4.js";import{Q as M}from"./QuizCard-CqO6yfKJ.js";import{Q as B}from"./QuizFilters-ChFlg3-s.js";import{u as E}from"./useQuizzes-Ce89MhCe.js";import{u as k}from"./useLanguages-joHChLWq.js";import{M as h}from"./MainLayout-BALAcp-P.js";import{u as q}from"./useTranslation-CC21zoU6.js";import{L as O}from"./loader-circle-BTqhVs_v.js";import{B as P}from"./book-open-SIfqpxXT.js";import"./badge-B57fkYpB.js";import"./file-question-DCxyUbKp.js";import"./clock-BfSKEJpp.js";import"./target-Dx8SBibj.js";import"./input-Dl5UbgYB.js";import"./label-Byme5i-Q.js";import"./select-Djc9bocP.js";import"./index-CNkEgW_D.js";import"./Combination-dIoxx1Zk.js";import"./index-CrWK1cfR.js";import"./index-wpz6Hu0Z.js";import"./check-BhLxpiQA.js";import"./search-D3snqzKk.js";import"./useQuery-BIga7gMY.js";import"./useMutation-C5-Yw93X.js";import"./useInfiniteQuery-B5ANnVOJ.js";import"./useResponsiveLogo-oJ2RCBfb.js";import"./LanguageSwitcher-CFBw11ZH.js";import"./index-CKCShlFX.js";import"./Logo-qwv8thKT.js";import"./user-CgQqfPiY.js";import"./log-out-CEU61esy.js";import"./users-8lpkJKwV.js";const Ne=()=>{const{t:a}=q(),{locale:o}=_(),{user:i}=F(),[r,d]=t.useState({});t.useEffect(()=>{i!=null&&i.preferred_language_id&&r.languageId===void 0&&d(s=>({...s,languageId:i.preferred_language_id}))},[i==null?void 0:i.preferred_language_id,r.languageId]);const{data:n,isLoading:b,isError:y,fetchNextPage:f,hasNextPage:j,isFetchingNextPage:u,refetch:Q}=E({is_active:!0,language_id:r.languageId}),{data:g}=k(),p=t.useRef(null),c=t.useMemo(()=>(n==null?void 0:n.pages.flatMap(s=>s.quizzes))||[],[n]);t.useEffect(()=>{if(!p.current||!j||u)return;const s=new IntersectionObserver(m=>{m[0].isIntersecting&&f()},{threshold:.1});return s.observe(p.current),()=>s.disconnect()},[f,j,u]);const I=t.useMemo(()=>g?g.map(s=>({id:s.id,name:s.name})):[],[g,o]),N=t.useMemo(()=>!c||c.length===0?[]:c.filter(s=>{var m,z;if(r.languageId&&s.language_id!==r.languageId||r.level&&s.level!==r.level)return!1;if(r.search){const v=r.search.toLowerCase(),L=s.title[o]||s.title.en,C=((m=s.description)==null?void 0:m[o])||((z=s.description)==null?void 0:z.en)||"";if(!L.toLowerCase().includes(v)&&!C.toLowerCase().includes(v))return!1}return!0}),[c,r,o]);return b?e.jsx(h,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:a("quiz.browseQuizzes")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(s=>e.jsx(l,{className:"h-10 w-full"},s))}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3,4,5,6].map(s=>e.jsxs(x,{className:"p-6",children:[e.jsx(l,{className:"h-6 w-3/4 mb-4"}),e.jsx(l,{className:"h-4 w-1/2 mb-2"}),e.jsx(l,{className:"h-4 w-2/3 mb-2"}),e.jsx(l,{className:"h-4 w-1/2"})]},s))})]})}):y?e.jsx(h,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:a("quiz.browseQuizzes")}),e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-red-600",children:a("quiz.errorLoadingQuizzes")}),e.jsx(w,{onClick:()=>Q(),children:a("common.retry")})]})})]})}):e.jsx(h,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:a("quiz.browseQuizzes")}),e.jsx(B,{languageId:r.languageId,level:r.level,search:r.search,languages:I,onChange:d}),N.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:N.map(s=>e.jsx(M,{quiz:s},s.id))}),e.jsx("div",{ref:p,className:"flex justify-center py-8",children:u&&e.jsx(O,{className:"w-8 h-8 animate-spin text-primary-500"})})]}):e.jsx(x,{className:"p-12",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(P,{className:"w-16 h-16 mx-auto text-gray-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-700",children:a("quiz.noQuizzesFound")}),e.jsx("p",{className:"text-gray-500",children:r.languageId||r.level||r.search?a("quiz.tryDifferentFilters"):a("quiz.noQuizzesAvailable")}),(r.languageId||r.level||r.search)&&e.jsx(w,{variant:"outline",onClick:()=>d({}),children:a("quiz.clearFilters")})]})})]})})};export{Ne as BrowseQuizzes,Ne as default};
