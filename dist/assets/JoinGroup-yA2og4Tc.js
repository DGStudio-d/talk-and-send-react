import{u as E,r as g,j as s,J as _}from"./index-BbbxppCW.js";import{e as I,f as H}from"./useSubscriptions-CXEXM7mV.js";import{u as O}from"./useLanguages-joHChLWq.js";import{M as V}from"./MainLayout-BALAcp-P.js";import{C as h,b as w,a as j,d as A,c as $,e as R}from"./card-zbz7qCJr.js";import{B as G}from"./button-CIKh5vM4.js";import{S as q,a as z,b as K,c as Q,d as b}from"./select-Djc9bocP.js";import{S as m}from"./skeleton-TmsLY8PM.js";import{B as W}from"./badge-B57fkYpB.js";import{A as X,a as Y,b as Z,c as ss,d as es,e as is,f as rs,g as ts}from"./alert-dialog-BMVIkOSi.js";import{a as d}from"./translationHelpers-BzGVKULz.js";import{u as as}from"./useTranslation-CC21zoU6.js";import{U as ns}from"./user-CgQqfPiY.js";import{U as os}from"./users-8lpkJKwV.js";import{C as ls}from"./clock-BfSKEJpp.js";import{C as cs}from"./calendar-BGtI_0eA.js";import"./useQuery-BIga7gMY.js";import"./useMutation-C5-Yw93X.js";import"./useResponsiveLogo-oJ2RCBfb.js";import"./LanguageSwitcher-CFBw11ZH.js";import"./index-CNkEgW_D.js";import"./Combination-dIoxx1Zk.js";import"./index-CKCShlFX.js";import"./index-CrWK1cfR.js";import"./check-BhLxpiQA.js";import"./Logo-qwv8thKT.js";import"./log-out-CEU61esy.js";import"./book-open-SIfqpxXT.js";import"./index-wpz6Hu0Z.js";import"./index-BtDOLYso.js";const Is=()=>{var N,v;const{t:e,i18n:o}=as(),f=E(),[c,L]=g.useState(null),[r,J]=g.useState(null),[k,u]=g.useState(!1),{data:p,isLoading:M}=O(),{data:x,isLoading:B}=I({language_id:c}),l=H(),F=i=>{J(i),u(!0)},P=async()=>{var i,n;if(r)try{await l.mutateAsync(r.id),_.success(e("subscription.joinGroupSuccess")),u(!1),f("/subscriptions/my-subscriptions")}catch(t){_.error(((n=(i=t.response)==null?void 0:i.data)==null?void 0:n.message)||e("subscription.joinGroupError"))}},T=i=>new Date(i).toLocaleDateString(o.language,{year:"numeric",month:"long",day:"numeric"}),U=i=>{const n=i.max_members||0,t=i.current_members||0;return n-t};return s.jsxs(V,{children:[s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold",children:e("subscription.joinGroup")}),s.jsx("p",{className:"text-muted-foreground mt-2",children:e("subscription.joinGroupDescription")})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("label",{htmlFor:"language-filter",className:"text-sm font-medium",children:e("subscription.filterByLanguage")}),s.jsxs(q,{value:(c==null?void 0:c.toString())||"all",onValueChange:i=>L(i==="all"?null:parseInt(i)),children:[s.jsx(z,{id:"language-filter",className:"w-[200px]",children:s.jsx(K,{placeholder:e("subscription.allLanguages")})}),s.jsxs(Q,{children:[s.jsx(b,{value:"all",children:e("subscription.allLanguages")}),M?s.jsx(b,{value:"loading",disabled:!0,children:e("common.loading")}):p==null?void 0:p.map(i=>s.jsx(b,{value:i.id.toString(),children:d(i,o.language)},i.id))]})]})]}),B?s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3].map(i=>s.jsxs(h,{children:[s.jsxs(w,{children:[s.jsx(m,{className:"h-6 w-3/4"}),s.jsx(m,{className:"h-4 w-full mt-2"})]}),s.jsx(j,{children:s.jsx(m,{className:"h-24 w-full"})}),s.jsx(A,{children:s.jsx(m,{className:"h-10 w-full"})})]},i))}):x&&x.length>0?s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:x.map(i=>{var S,y,D;const n=U(i),t=n<=0,a=(S=i.subscription)==null?void 0:S.subscription_plan,C=(y=i.subscription)==null?void 0:y.teacher;return s.jsxs(h,{className:"flex flex-col",children:[s.jsxs(w,{children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsx($,{children:i.group_name}),s.jsx(W,{variant:t?"destructive":"default",children:e(t?"subscription.full":"subscription.available")})]}),s.jsx(R,{children:a?e("subscription.planDescription",{type:e(`subscription.${a.type}`),language:d(a.language,o.language)}):""})]}),s.jsxs(j,{className:"flex-1 space-y-4",children:[C&&s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(ns,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs("span",{children:[e("subscription.teacher"),": ",C.name]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(os,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs("span",{children:[i.current_members||0," / ",i.max_members," ",e("subscription.members")]})]}),!t&&s.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:[n," ",e("subscription.slotsAvailable")]}),a&&s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(ls,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs("span",{children:[a.sessions_per_month," ",e("subscription.sessions")," Ã—"," ",a.session_duration_minutes," ",e("subscription.minutes")]})]}),((D=i.subscription)==null?void 0:D.start_date)&&s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(cs,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs("span",{children:[e("subscription.startsOn"),": ",T(i.subscription.start_date)]})]}),s.jsxs("div",{className:"text-sm text-muted-foreground",children:[e("common.language"),":"," ",d(a==null?void 0:a.language,o.language)]})]}),s.jsx(A,{children:s.jsx(G,{className:"w-full",onClick:()=>F(i),disabled:t||l.isPending,children:l.isPending?e("common.loading"):e(t?"subscription.groupFull":"subscription.joinGroup")})})]},i.id)})}):s.jsx(h,{children:s.jsxs(j,{className:"py-12 text-center space-y-4",children:[s.jsx("p",{className:"text-muted-foreground",children:e("subscription.noGroupsAvailable")}),s.jsx(G,{onClick:()=>f("/subscriptions/plans"),children:e("subscription.viewIndividualPlans")})]})})]}),s.jsx(X,{open:k,onOpenChange:u,children:s.jsxs(Y,{children:[s.jsxs(Z,{children:[s.jsx(ss,{children:e("subscription.confirmJoinGroup")}),s.jsx(es,{children:r&&s.jsxs("div",{className:"space-y-2 mt-4",children:[s.jsxs("p",{children:[s.jsxs("strong",{children:[e("subscription.group"),":"]})," ",r.group_name]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[e("subscription.plan"),":"]})," ",(N=r.subscription)!=null&&N.subscription_plan?e("subscription.planDescription",{type:e(`subscription.${r.subscription.subscription_plan.type}`),language:d(r.subscription.subscription_plan.language,o.language)}):""]}),((v=r.subscription)==null?void 0:v.teacher)&&s.jsxs("p",{children:[s.jsxs("strong",{children:[e("subscription.teacher"),":"]})," ",r.subscription.teacher.name]}),s.jsx("p",{className:"text-sm text-muted-foreground mt-4",children:e("subscription.confirmJoinGroupMessage")})]})})]}),s.jsxs(is,{children:[s.jsx(rs,{children:e("common.cancel")}),s.jsx(ts,{onClick:P,disabled:l.isPending,children:l.isPending?e("common.loading"):e("common.confirm")})]})]})})]})};export{Is as default};
