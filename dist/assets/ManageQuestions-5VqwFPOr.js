import{c as te,e as B,q as E,j as e,J as _,d as re,u as ne,r as b}from"./index-BbbxppCW.js";import{a as ae}from"./useQuizzes-Ce89MhCe.js";import{u as M}from"./useMutation-C5-Yw93X.js";import{B as l}from"./button-CIKh5vM4.js";import{C as k,b as G,a as J,c as ie}from"./card-zbz7qCJr.js";import{S as F}from"./skeleton-TmsLY8PM.js";import{B as O}from"./badge-B57fkYpB.js";import{T as oe,a as ce,b as R,c as Q,d as le,e as v}from"./table-D7A3MFyr.js";import{A as de,a as he,b as me,c as xe,d as pe,e as je,f as ue,g as ge}from"./alert-dialog-BMVIkOSi.js";import{D as fe,a as ye,b as De,c as _e,d as Ce}from"./dialog-B0Pn59SX.js";import{M as I}from"./MainLayout-BALAcp-P.js";import{u as Ne}from"./index.esm-CYaOjpFt.js";import{o as be,s as g,e as Qe,t as ve}from"./zod-BufzoQnV.js";import{F as we,a as h,b as m,c as x,d as p,f as Se,e as j}from"./form-CqNglPU9.js";import{I as w}from"./input-Dl5UbgYB.js";import{T as U}from"./textarea-BiZKJTtT.js";import{S as Te,a as Ae,b as ze,c as ke,d as S}from"./select-Djc9bocP.js";import{u as $}from"./useTranslation-CC21zoU6.js";import{P as Y}from"./plus-Cb59kCLE.js";import{S as Fe}from"./square-pen-DumwSmrg.js";import{T as Oe}from"./trash-2-CaDzUwOu.js";import"./useQuery-BIga7gMY.js";import"./useInfiniteQuery-B5ANnVOJ.js";import"./index-BtDOLYso.js";import"./index-CrWK1cfR.js";import"./Combination-dIoxx1Zk.js";import"./useResponsiveLogo-oJ2RCBfb.js";import"./LanguageSwitcher-CFBw11ZH.js";import"./index-CNkEgW_D.js";import"./index-CKCShlFX.js";import"./check-BhLxpiQA.js";import"./Logo-qwv8thKT.js";import"./user-CgQqfPiY.js";import"./log-out-CEU61esy.js";import"./users-8lpkJKwV.js";import"./book-open-SIfqpxXT.js";import"./label-Byme5i-Q.js";import"./index-wpz6Hu0Z.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=te("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),Be=()=>{const i=B();return M({mutationFn:async({quizId:s,data:n})=>(await E.create(s,n)).data.data,onSuccess:(s,n)=>{i.invalidateQueries({queryKey:["quiz",n.quizId]})}})},Ee=()=>{const i=B();return M({mutationFn:async({id:s,data:n,quizId:c})=>(await E.update(s,n)).data.data,onSuccess:(s,n)=>{i.invalidateQueries({queryKey:["quiz",n.quizId]})}})},Me=()=>{const i=B();return M({mutationFn:async({id:s,quizId:n})=>(await E.delete(s)).data,onSuccess:(s,n)=>{i.invalidateQueries({queryKey:["quiz",n.quizId]})}})},Pe=be({question_text:g().min(5,"Question must be at least 5 characters"),option_a:g().min(1,"Option A is required"),option_b:g().min(1,"Option B is required"),option_c:g().min(1,"Option C is required"),option_d:g().min(1,"Option D is required"),correct_option:Qe(["A","B","C","D"]),explanation:g().optional()}),Le=({quizId:i,question:s,onSuccess:n,onCancel:c})=>{const{t}=$(),f=Be(),y=Ee(),a=Ne({resolver:ve(Pe),defaultValues:{question_text:(s==null?void 0:s.question_text)||"",option_a:(s==null?void 0:s.option_a)||"",option_b:(s==null?void 0:s.option_b)||"",option_c:(s==null?void 0:s.option_c)||"",option_d:(s==null?void 0:s.option_d)||"",correct_option:(s==null?void 0:s.correct_option)||"A",explanation:(s==null?void 0:s.explanation)||""}}),C=async r=>{var u,D;try{const d={question_text:r.question_text,option_a:r.option_a,option_b:r.option_b,option_c:r.option_c,option_d:r.option_d,correct_option:r.correct_option,explanation:r.explanation||null};s?(await y.mutateAsync({id:s.id,data:d,quizId:i}),_.success(t("teacher.questionUpdatedSuccess"))):(await f.mutateAsync({quizId:i,data:d}),_.success(t("teacher.questionCreatedSuccess"))),n()}catch(d){_.error(((D=(u=d.response)==null?void 0:u.data)==null?void 0:D.message)||t("teacher.questionSaveError"))}};return e.jsx(we,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(C),className:"space-y-6",children:[e.jsx(h,{control:a.control,name:"question_text",render:({field:r})=>e.jsxs(m,{children:[e.jsx(x,{children:t("teacher.questionText")}),e.jsx(p,{children:e.jsx(U,{placeholder:t("teacher.enterQuestionEnglish"),className:"min-h-20",...r})}),e.jsx(Se,{children:t("teacher.questionInQuizLanguage")}),e.jsx(j,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:t("teacher.answerOptions")}),e.jsx(h,{control:a.control,name:"option_a",render:({field:r})=>e.jsxs(m,{children:[e.jsx(x,{children:t("teacher.optionA")}),e.jsx(p,{children:e.jsx(w,{placeholder:t("teacher.enterOptionA"),...r})}),e.jsx(j,{})]})}),e.jsx(h,{control:a.control,name:"option_b",render:({field:r})=>e.jsxs(m,{children:[e.jsx(x,{children:t("teacher.optionB")}),e.jsx(p,{children:e.jsx(w,{placeholder:t("teacher.enterOptionB"),...r})}),e.jsx(j,{})]})}),e.jsx(h,{control:a.control,name:"option_c",render:({field:r})=>e.jsxs(m,{children:[e.jsx(x,{children:t("teacher.optionC")}),e.jsx(p,{children:e.jsx(w,{placeholder:t("teacher.enterOptionC"),...r})}),e.jsx(j,{})]})}),e.jsx(h,{control:a.control,name:"option_d",render:({field:r})=>e.jsxs(m,{children:[e.jsx(x,{children:t("teacher.optionD")}),e.jsx(p,{children:e.jsx(w,{placeholder:t("teacher.enterOptionD"),...r})}),e.jsx(j,{})]})})]}),e.jsx(h,{control:a.control,name:"correct_option",render:({field:r})=>e.jsxs(m,{children:[e.jsx(x,{children:t("teacher.correctAnswer")}),e.jsxs(Te,{onValueChange:r.onChange,value:r.value,children:[e.jsx(p,{children:e.jsx(Ae,{children:e.jsx(ze,{placeholder:t("teacher.selectCorrectAnswer")})})}),e.jsxs(ke,{children:[e.jsx(S,{value:"A",children:t("teacher.optionA")}),e.jsx(S,{value:"B",children:t("teacher.optionB")}),e.jsx(S,{value:"C",children:t("teacher.optionC")}),e.jsx(S,{value:"D",children:t("teacher.optionD")})]})]}),e.jsx(j,{})]})}),e.jsx(h,{control:a.control,name:"explanation",render:({field:r})=>e.jsxs(m,{children:[e.jsxs(x,{children:[t("teacher.explanation")," (",t("teacher.optional"),")"]}),e.jsx(p,{children:e.jsx(U,{placeholder:t("teacher.enterExplanationEnglish"),className:"min-h-20",...r})}),e.jsx(j,{})]})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(l,{type:"button",variant:"outline",onClick:c,children:t("common.cancel")}),e.jsx(l,{type:"submit",disabled:f.isPending||y.isPending,children:f.isPending||y.isPending?t("common.loading"):t(s?"common.update":"common.create")})]})]})})},Qs=()=>{var q,H,V,K;const{id:i}=re(),{t:s}=$(),n=ne(),c=parseInt(i||"0"),{data:t,isLoading:f,isError:y,refetch:a}=ae(c);console.log("quiz",t);const C=Me(),[r,u]=b.useState(!1),[D,d]=b.useState(null),[W,N]=b.useState(!1),[T,A]=b.useState(null),X=async()=>{if(D)try{await C.mutateAsync({id:D,quizId:c}),_.success(s("teacher.questionDeletedSuccess")),u(!1),d(null)}catch{_.error(s("teacher.questionDeletedError"))}},Z=o=>{d(o),u(!0)},P=()=>{A(null),N(!0)},ee=o=>{A(o),N(!0)},L=()=>{N(!1),A(null)};if(f)return e.jsx(I,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(F,{className:"h-10 w-full"}),e.jsxs(k,{children:[e.jsx(G,{children:e.jsx(F,{className:"h-6 w-32"})}),e.jsx(J,{children:e.jsx(F,{className:"h-96 w-full"})})]})]})});if(y||!t)return e.jsx(I,{children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-red-600",children:s("teacher.errorLoadingQuiz")}),e.jsx(l,{onClick:()=>a(),children:s("common.retry")})]})})});const z=t.questions||[];return e.jsx(I,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:((q=t.title)==null?void 0:q.en)||t.title}),e.jsx("p",{className:"text-gray-600 mt-1",children:s("teacher.manageQuestions")}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(O,{variant:"outline",children:((V=(H=t.language)==null?void 0:H.name)==null?void 0:V.en)||((K=t.language)==null?void 0:K.name)}),e.jsx(O,{variant:"outline",children:s("levels."+(t.level||"beginner").toLowerCase())})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>n("/teacher/quizzes"),children:s("teacher.backToQuizzes")}),e.jsxs(l,{onClick:P,children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),s("teacher.addQuestion")]})]})]}),e.jsxs(k,{children:[e.jsx(G,{children:e.jsxs(ie,{children:[s("teacher.questions")," (",z.length,")"]})}),e.jsx(J,{children:z.length>0?e.jsxs(oe,{children:[e.jsx(ce,{children:e.jsxs(R,{children:[e.jsx(Q,{className:"w-12",children:"#"}),e.jsx(Q,{children:s("teacher.questionText")}),e.jsx(Q,{children:s("teacher.correctAnswer")}),e.jsx(Q,{className:"text-right",children:s("common.actions")})]})}),e.jsx(le,{children:z.map((o,se)=>e.jsxs(R,{children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4 text-gray-400 cursor-move"}),e.jsx("span",{className:"font-medium",children:se+1})]})}),e.jsx(v,{className:"max-w-md",children:e.jsx("p",{className:"line-clamp-2",children:o.question_text})}),e.jsx(v,{children:e.jsxs(O,{variant:"secondary",children:[s("teacher.option")," ",o.correct_option]})}),e.jsx(v,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>ee(o),children:e.jsx(Fe,{className:"w-4 h-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>Z(o.id),disabled:C.isPending,children:e.jsx(Oe,{className:"w-4 h-4"})})]})})]},o.id))})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:s("teacher.noQuestionsYet")}),e.jsxs(l,{onClick:P,children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),s("teacher.addFirstQuestion")]})]})})]}),e.jsx(fe,{open:W,onOpenChange:N,children:e.jsxs(ye,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(De,{children:[e.jsx(_e,{children:s(T?"teacher.editQuestion":"teacher.addQuestion")}),e.jsx(Ce,{children:s(T?"teacher.editQuestionDescription":"teacher.addQuestionDescription")})]}),e.jsx(Le,{quizId:c,question:T,onSuccess:L,onCancel:L})]})}),e.jsx(de,{open:r,onOpenChange:u,children:e.jsxs(he,{children:[e.jsxs(me,{children:[e.jsx(xe,{children:s("teacher.deleteQuestionTitle")}),e.jsx(pe,{children:s("teacher.deleteQuestionMessage")})]}),e.jsxs(je,{children:[e.jsx(ue,{children:s("common.cancel")}),e.jsx(ge,{onClick:X,children:s("common.delete")})]})]})})]})})};export{Qs as ManageQuestions,Qs as default};
