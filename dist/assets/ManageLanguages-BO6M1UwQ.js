import{r as d,j as e,J as c}from"./index-BbbxppCW.js";import{a as U,b as R,u as B,c as H,d as z,e as $}from"./useLanguages-joHChLWq.js";import{B as f}from"./button-CIKh5vM4.js";import{C as J}from"./card-zbz7qCJr.js";import{T as O,a as G,b as P,c as j,d as V,e as x}from"./table-D7A3MFyr.js";import{A as X,a as Y,b as Z,c as q,d as K,e as Q,f as W,g as ee}from"./alert-dialog-BMVIkOSi.js";import{S as ae}from"./switch-D6hUCL8N.js";import{S as k}from"./skeleton-TmsLY8PM.js";import{A as se,a as ne}from"./alert-Ckbomrq-.js";import{B as re}from"./badge-B57fkYpB.js";import{u as te}from"./index.esm-CYaOjpFt.js";import{o as ie,s as E,t as le}from"./zod-BufzoQnV.js";import{D as me,a as ce,b as de,c as oe,e as ge}from"./dialog-B0Pn59SX.js";import{I as S}from"./input-Dl5UbgYB.js";import{L as N}from"./label-Byme5i-Q.js";import{u as I}from"./useTranslation-CC21zoU6.js";import{M}from"./MainLayout-BALAcp-P.js";import{P as ue}from"./plus-Cb59kCLE.js";import{U as xe}from"./upload-C3ONQcIS.js";import{P as he}from"./pencil-yIgd1Bop.js";import{T as pe}from"./trash-2-CaDzUwOu.js";import"./useQuery-BIga7gMY.js";import"./useMutation-C5-Yw93X.js";import"./index-BtDOLYso.js";import"./index-CrWK1cfR.js";import"./Combination-dIoxx1Zk.js";import"./index-wpz6Hu0Z.js";import"./useResponsiveLogo-oJ2RCBfb.js";import"./LanguageSwitcher-CFBw11ZH.js";import"./index-CNkEgW_D.js";import"./index-CKCShlFX.js";import"./check-BhLxpiQA.js";import"./Logo-qwv8thKT.js";import"./user-CgQqfPiY.js";import"./log-out-CEU61esy.js";import"./users-8lpkJKwV.js";import"./book-open-SIfqpxXT.js";const je=1024*1024,fe=["image/png","image/jpg","image/jpeg","image/svg+xml"],_e=ie({name_en:E().min(2,"English name must be at least 2 characters"),name_ar:E().min(2,"Arabic name must be at least 2 characters"),name_es:E().min(2,"Spanish name must be at least 2 characters"),code:E().min(2,"Code must be at least 2 characters").max(5,"Code must be at most 5 characters")}),be=({language:a,open:o,onClose:h})=>{const{t:n}=I(),[y,p]=d.useState(null),[A,l]=d.useState(null),[_,i]=d.useState(null),g=U(),C=R(),{register:b,handleSubmit:T,formState:{errors:t},reset:v}=te({resolver:le(_e),defaultValues:a?{name_en:a.name_en,name_ar:a.name_ar,name_es:a.name_es,code:a.code}:{name_en:"",name_ar:"",name_es:"",code:""}});d.useEffect(()=>{a?(v({name_en:a.name_en,name_ar:a.name_ar,name_es:a.name_es,code:a.code}),a.flag_url&&l(a.flag_url)):(v({name_en:"",name_ar:"",name_es:"",code:""}),l(null)),p(null),i(null)},[a,v]);const w=u=>{var s;const r=(s=u.target.files)==null?void 0:s[0];if(!r){p(null),l(null),i(null);return}if(!fe.includes(r.type)){i(n("admin.languages.invalidFileType")),p(null),l(null);return}if(r.size>je){i(n("admin.languages.fileTooLarge")),p(null),l(null);return}i(null),p(r);const F=new FileReader;F.onloadend=()=>{l(F.result)},F.readAsDataURL(r)},D=async u=>{try{const r=new FormData;r.append("name_en",u.name_en),r.append("name_ar",u.name_ar),r.append("name_es",u.name_es),r.append("code",u.code),y&&r.append("flag_image",y),a?(await C.mutateAsync({id:a.id,data:r}),c.success(n("admin.languages.updateSuccess"))):(await g.mutateAsync(r),c.success(n("admin.languages.createSuccess"))),h()}catch{c.error(n(a?"admin.languages.updateError":"admin.languages.createError"))}};return e.jsx(me,{open:o,onOpenChange:h,children:e.jsxs(ce,{className:"sm:max-w-[600px]",children:[e.jsx(de,{children:e.jsx(oe,{children:n(a?"admin.languages.editLanguage":"admin.languages.addLanguage")})}),e.jsxs("form",{onSubmit:T(D),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"name_en",children:n("admin.languages.nameEn")}),e.jsx(S,{id:"name_en",...b("name_en"),className:t.name_en?"border-red-500":""}),t.name_en&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.name_en.message})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"name_ar",children:n("admin.languages.nameAr")}),e.jsx(S,{id:"name_ar",...b("name_ar"),className:t.name_ar?"border-red-500":"",dir:"rtl"}),t.name_ar&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.name_ar.message})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"name_es",children:n("admin.languages.nameEs")}),e.jsx(S,{id:"name_es",...b("name_es"),className:t.name_es?"border-red-500":""}),t.name_es&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.name_es.message})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"code",children:n("admin.languages.code")}),e.jsx(S,{id:"code",...b("code"),className:t.code?"border-red-500":"",placeholder:"e.g., en, ar, es"}),t.code&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.code.message})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"flag_image",children:n("admin.languages.flagImage")}),e.jsx(S,{id:"flag_image",type:"file",accept:"image/png,image/jpg,image/jpeg,image/svg+xml",onChange:w,className:_?"border-red-500":""}),_&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:_}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:n("admin.languages.flagImageHint")})]}),A&&e.jsxs("div",{children:[e.jsx(N,{children:n("admin.languages.preview")}),e.jsx("div",{className:"mt-2 border rounded-lg p-4 bg-gray-50",children:e.jsx("img",{src:A,alt:"Flag preview",className:"w-24 h-16 object-cover rounded"})})]}),e.jsxs(ge,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:h,children:n("common.cancel")}),e.jsx(f,{type:"submit",disabled:g.isPending||C.isPending,children:g.isPending||C.isPending?n("common.saving"):n(a?"common.update":"common.create")})]})]})]})})},ta=()=>{const{t:a}=I(),[o,h]=d.useState(null),[n,y]=d.useState(null),[p,A]=d.useState(!1),[l,_]=d.useState(null),i=d.useRef(null),{data:g,isLoading:C,isError:b,refetch:T}=B(),t=H(),v=z(),w=$();console.log(g);const D=async()=>{if(o)try{await t.mutateAsync(o.id),c.success(a("admin.languages.deleteSuccess")),h(null)}catch{c.error(a("admin.languages.deleteError"))}},u=async s=>{try{await v.mutateAsync(s.id),c.success(s.is_active?a("admin.languages.deactivateSuccess"):a("admin.languages.activateSuccess"))}catch{c.error(a("admin.languages.toggleError"))}},r=s=>{var m;_(s),(m=i.current)==null||m.click()},F=async s=>{var L;const m=(L=s.target.files)==null?void 0:L[0];if(!(!m||!l))try{await w.mutateAsync({id:l,file:m}),c.success(a("admin.languages.flagUploadSuccess")),_(null),i.current&&(i.current.value="")}catch{c.error(a("admin.languages.flagUploadError"))}};return C?e.jsx(M,{children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:a("admin.languages.title")}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(k,{className:"h-10 w-full"}),e.jsx(k,{className:"h-96 w-full"})]})]})}):b?e.jsx(M,{children:e.jsxs("div",{children:[e.jsx(se,{variant:"destructive",children:e.jsx(ne,{children:a("admin.languages.error")})}),e.jsx(f,{onClick:()=>T(),className:"mt-4",children:a("common.retry")})]})}):e.jsx(M,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:a("admin.languages.title")}),e.jsxs(f,{onClick:()=>A(!0),children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),a("admin.languages.addLanguage")]})]}),e.jsx(J,{children:e.jsxs(O,{children:[e.jsx(G,{children:e.jsxs(P,{children:[e.jsx(j,{children:a("admin.languages.flag")}),e.jsx(j,{children:a("admin.languages.nameEn")}),e.jsx(j,{children:a("admin.languages.nameAr")}),e.jsx(j,{children:a("admin.languages.nameEs")}),e.jsx(j,{children:a("admin.languages.code")}),e.jsx(j,{children:a("admin.languages.active")}),e.jsx(j,{className:"text-right",children:a("admin.languages.actions")})]})}),e.jsx(V,{children:g&&g.length>0?g.map(s=>e.jsxs(P,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:`${s.flag_url}}`,alt:s.name_en,className:"w-8 h-6 object-cover rounded",onError:m=>{var L;m.currentTarget.style.display="none",(L=m.currentTarget.nextElementSibling)==null||L.classList.remove("hidden")}}),e.jsx("div",{className:`w-8 h-6 bg-gray-200 rounded flex items-center justify-center ${s.flag_url?"hidden":""}`,children:e.jsx("span",{className:"text-xs text-gray-500",children:"N/A"})}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>r(s.id),disabled:w.isPending,title:a("admin.languages.uploadFlag"),children:e.jsx(xe,{className:"w-3 h-3"})})]})}),e.jsx(x,{className:"font-medium",children:s.name_en}),e.jsx(x,{children:s.name_ar}),e.jsx(x,{children:s.name_es}),e.jsx(x,{children:e.jsx(re,{variant:"outline",children:s.code})}),e.jsx(x,{children:e.jsx(ae,{checked:s.is_active,onCheckedChange:()=>u(s),disabled:v.isPending})}),e.jsx(x,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>y(s),children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>h(s),children:e.jsx(pe,{className:"w-4 h-4 text-red-600"})})]})})]},s.id)):e.jsx(P,{children:e.jsx(x,{colSpan:7,className:"text-center py-8 text-gray-500",children:a("admin.languages.noLanguages")})})})]})}),e.jsx(X,{open:!!o,onOpenChange:()=>h(null),children:e.jsxs(Y,{children:[e.jsxs(Z,{children:[e.jsx(q,{children:a("admin.languages.deleteConfirmTitle")}),e.jsx(K,{children:a("admin.languages.deleteConfirmMessage",{name:o==null?void 0:o.name_en})})]}),e.jsxs(Q,{children:[e.jsx(W,{children:a("common.cancel")}),e.jsx(ee,{onClick:D,className:"bg-red-600 hover:bg-red-700",children:a("common.delete")})]})]})}),e.jsx(be,{language:n,open:p||!!n,onClose:()=>{A(!1),y(null)}}),e.jsx("input",{ref:i,type:"file",accept:"image/png,image/jpg,image/jpeg,image/svg+xml,image/webp",onChange:F,className:"hidden"})]})})};export{ta as default};
