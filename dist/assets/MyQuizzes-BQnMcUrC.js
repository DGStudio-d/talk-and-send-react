import{u as R,r as N,j as e,J as n}from"./index-BbbxppCW.js";import{b as U,c as P,d as q}from"./useQuizzes-Ce89MhCe.js";import{B as l}from"./button-CIKh5vM4.js";import{C as j,b as C,a as E,c as $}from"./card-zbz7qCJr.js";import{S as g}from"./skeleton-TmsLY8PM.js";import{B as y}from"./badge-B57fkYpB.js";import{A as F,a as J,b as H,c as Y,d as G,e as K,f as V,g as W}from"./alert-dialog-BMVIkOSi.js";import{M as w}from"./MainLayout-BALAcp-P.js";import{u as X}from"./useTranslation-CC21zoU6.js";import{U as Z}from"./upload-C3ONQcIS.js";import{D as ee}from"./download-n5VnPR3i.js";import{P as S}from"./plus-Cb59kCLE.js";import{S as se}from"./square-pen-DumwSmrg.js";import{E as te,a as ae}from"./eye-DpgY7ATH.js";import{T as re}from"./trash-2-CaDzUwOu.js";import{B as ie}from"./book-open-SIfqpxXT.js";import"./useQuery-BIga7gMY.js";import"./useMutation-C5-Yw93X.js";import"./useInfiniteQuery-B5ANnVOJ.js";import"./index-BtDOLYso.js";import"./index-CrWK1cfR.js";import"./Combination-dIoxx1Zk.js";import"./useResponsiveLogo-oJ2RCBfb.js";import"./LanguageSwitcher-CFBw11ZH.js";import"./index-CNkEgW_D.js";import"./index-CKCShlFX.js";import"./check-BhLxpiQA.js";import"./Logo-qwv8thKT.js";import"./user-CgQqfPiY.js";import"./log-out-CEU61esy.js";import"./users-8lpkJKwV.js";const Me=()=>{const{t}=X(),f=R(),{data:o,isLoading:A,isError:T,refetch:u}=U(),D=P(),z=q(),[Q,v]=N.useState(!1),[b,k]=N.useState(null),m=N.useRef(null),_=async()=>{try{const s=localStorage.getItem("auth_token"),a=await fetch("http://localhost:8000/api/quizzes/export?format=csv",{headers:{Authorization:`Bearer ${s}`}});if(!a.ok){const c=await a.json().catch(()=>({}));throw new Error(c.message||"Export failed")}const h=a.headers.get("content-type");if(h&&h.includes("application/json")){const c=await a.json();throw new Error(c.message||"Export returned JSON instead of file")}const d=await a.blob(),r=window.URL.createObjectURL(d),i=document.createElement("a");i.href=r;const p=a.headers.get("content-disposition");let x=`quizzes-${new Date().toISOString().split("T")[0]}.csv`;if(p){const c=p.match(/filename="?(.+)"?/i);c&&(x=c[1])}i.download=x,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(r),document.body.removeChild(i),n.success(t("teacher.exportSuccess"))}catch(s){console.error("Export error:",s),n.error(s.message||t("teacher.exportError"))}},O=()=>{var s;(s=m.current)==null||s.click()},B=async s=>{var d;const a=(d=s.target.files)==null?void 0:d[0];if(!a)return;if(!["text/csv","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(a.type)&&!a.name.match(/\.(csv|xlsx|xls)$/i)){n.error(t("teacher.invalidFileType")),m.current&&(m.current.value="");return}try{const r=new FormData;r.append("file",a);const i=localStorage.getItem("auth_token"),p=await fetch("http://localhost:8000/api/quizzes/import",{method:"POST",headers:{Authorization:`Bearer ${i}`},body:r}),x=await p.json();if(!p.ok)throw new Error(x.message||"Import failed");const c=x.data;n.success(t("teacher.importSuccessDetails",{quizzes:c.created_quizzes||0,questions:c.created_questions||0,skipped:c.skipped_rows||0})),u()}catch(r){n.error(r.message||t("teacher.importError"))}m.current&&(m.current.value="")},L=async()=>{if(b)try{await D.mutateAsync(b),n.success(t("teacher.quizDeletedSuccess")),v(!1),k(null),u()}catch{n.error(t("teacher.quizDeletedError"))}},M=async s=>{try{await z.mutateAsync(s),u(),n.success(t("teacher.quizStatusUpdated"))}catch{n.error(t("teacher.quizStatusError"))}},I=s=>{k(s),v(!0)};return A?e.jsx(w,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(g,{className:"h-10 w-48"}),e.jsx(g,{className:"h-10 w-32"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3,4,5,6].map(s=>e.jsxs(j,{children:[e.jsx(C,{children:e.jsx(g,{className:"h-6 w-full"})}),e.jsx(E,{children:e.jsx(g,{className:"h-20 w-full"})})]},s))})]})}):T?e.jsx(w,{children:e.jsx("div",{children:e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-red-600",children:t("teacher.errorLoadingQuizzes")}),e.jsx(l,{onClick:()=>u(),children:t("common.retry")})]})})})}):e.jsx(w,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:t("teacher.myQuizzes")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"outline",onClick:O,children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),t("teacher.import")]}),e.jsxs(l,{variant:"outline",onClick:_,children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),t("teacher.export")]}),e.jsxs(l,{onClick:()=>f("/teacher/quizzes/create"),children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),t("teacher.createQuiz")]})]})]}),e.jsx("input",{ref:m,type:"file",accept:".csv,.xlsx,.xls",onChange:B,className:"hidden"}),o!=null&&o.quizzes&&(o==null?void 0:o.quizzes.length)>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o==null?void 0:o.quizzes.map(s=>{var a,h,d,r,i;return e.jsxs(j,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(C,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx($,{className:"text-lg line-clamp-2",children:((a=s.title)==null?void 0:a.en)||s.title||t("quiz.untitled")}),e.jsx(y,{variant:s.is_active?"default":"secondary",children:s.is_active?t("common.active"):t("common.inactive")})]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:((h=s.description)==null?void 0:h.en)||s.description||t("common.noDescription")}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-sm",children:[e.jsx(y,{variant:"outline",children:((r=(d=s.language)==null?void 0:d.name)==null?void 0:r.en)||((i=s.language)==null?void 0:i.name)}),e.jsx(y,{variant:"outline",children:t("levels."+(s.level||"beginner").toLowerCase())})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:t("quiz.questions")}),e.jsx("p",{className:"font-semibold",children:s.questions_count||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:t("teacher.attempts")}),e.jsx("p",{className:"font-semibold",children:s.attempts_count||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:t("quiz.duration")}),e.jsxs("p",{className:"font-semibold",children:[s.duration_minutes," ",t("quiz.minutes")]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:t("quiz.passingScore")}),e.jsxs("p",{className:"font-semibold",children:[s.passing_score,"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(l,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>f(`/teacher/quizzes/${s.id}/questions`),children:[e.jsx(se,{className:"w-4 h-4 mr-1"}),t("teacher.manageQuestions")]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>M(s.id),disabled:z.isPending,children:s.is_active?e.jsx(te,{className:"w-4 h-4"}):e.jsx(ae,{className:"w-4 h-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>I(s.id),disabled:D.isPending,children:e.jsx(re,{className:"w-4 h-4"})})]})]})]},s.id)})}):e.jsx(j,{className:"p-12",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(ie,{className:"w-16 h-16 mx-auto text-gray-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t("teacher.noQuizzesYet")}),e.jsx("p",{className:"text-gray-600 mt-2",children:t("teacher.createFirstQuizDescription")})]}),e.jsxs(l,{onClick:()=>f("/teacher/quizzes/create"),children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),t("teacher.createQuiz")]})]})}),e.jsx(F,{open:Q,onOpenChange:v,children:e.jsxs(J,{children:[e.jsxs(H,{children:[e.jsx(Y,{children:t("teacher.deleteQuizTitle")}),e.jsx(G,{children:t("teacher.deleteQuizMessage")})]}),e.jsxs(K,{children:[e.jsx(V,{children:t("common.cancel")}),e.jsx(W,{onClick:L,children:t("common.delete")})]})]})})]})})};export{Me as MyQuizzes,Me as default};
