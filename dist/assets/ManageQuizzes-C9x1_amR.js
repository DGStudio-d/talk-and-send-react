import{u as G,e as V,r as o,j as e,J as a,af as E}from"./index-BbbxppCW.js";import{c as W,d as X,g as Y}from"./useQuizzes-Ce89MhCe.js";import{u as Z}from"./useLanguages-joHChLWq.js";import{B as d}from"./button-CIKh5vM4.js";import{C as ee}from"./card-zbz7qCJr.js";import{Q as se}from"./QuizFilters-ChFlg3-s.js";import{T as te,a as ie,b as q,c as m,d as ae,e as l}from"./table-D7A3MFyr.js";import{A as re,a as ne,b as oe,c as le,d as ce,e as de,f as me,g as ue}from"./alert-dialog-BMVIkOSi.js";import{S as k}from"./skeleton-TmsLY8PM.js";import{A as pe,a as he}from"./alert-Ckbomrq-.js";import{B as xe}from"./badge-B57fkYpB.js";import{S as fe}from"./switch-D6hUCL8N.js";import{M as C}from"./MainLayout-BALAcp-P.js";import{u as je}from"./useTranslation-CC21zoU6.js";import{U as ge}from"./upload-C3ONQcIS.js";import{D as ze}from"./download-n5VnPR3i.js";import{P as ve}from"./plus-Cb59kCLE.js";import{a as ye,E as we}from"./eye-DpgY7ATH.js";import{P as Ne}from"./pencil-yIgd1Bop.js";import{T as qe}from"./trash-2-CaDzUwOu.js";import"./useQuery-BIga7gMY.js";import"./useMutation-C5-Yw93X.js";import"./useInfiniteQuery-B5ANnVOJ.js";import"./input-Dl5UbgYB.js";import"./label-Byme5i-Q.js";import"./select-Djc9bocP.js";import"./index-CNkEgW_D.js";import"./Combination-dIoxx1Zk.js";import"./index-CrWK1cfR.js";import"./index-wpz6Hu0Z.js";import"./check-BhLxpiQA.js";import"./search-D3snqzKk.js";import"./index-BtDOLYso.js";import"./useResponsiveLogo-oJ2RCBfb.js";import"./LanguageSwitcher-CFBw11ZH.js";import"./index-CKCShlFX.js";import"./Logo-qwv8thKT.js";import"./user-CgQqfPiY.js";import"./log-out-CEU61esy.js";import"./users-8lpkJKwV.js";import"./book-open-SIfqpxXT.js";const us=()=>{const{t:s}=je(),b=G(),f=V(),[j,Q]=o.useState(),[g,I]=o.useState(),[z,L]=o.useState(""),[v,y]=o.useState(null),[D,S]=o.useState(!1),[T,A]=o.useState(!1),h=o.useRef(null),{data:R}=Z(),F=W(),M=X(),O={...j&&{language_id:j},...g&&{level:g},...z&&{search:z}},{data:w,isLoading:_,isError:B,refetch:U}=Y(O),J=async()=>{v&&F.mutate(v.id,{onSuccess:()=>{a.success(s("admin.quizzes.deleteSuccess")),y(null),f.invalidateQueries({queryKey:["all-quizzes"]})},onError:()=>{a.error(s("admin.quizzes.deleteError"))}})},P=t=>{M.mutate(t.id,{onSuccess:()=>{a.success(s("admin.quizzes.toggleSuccess")),f.invalidateQueries({queryKey:["all-quizzes"]})},onError:()=>{a.error(s("admin.quizzes.toggleError"))}})},H=t=>{Q(t.languageId),I(t.level),L(t.search||"")},K=async t=>{var u,p,n;const i=(u=t.target.files)==null?void 0:u[0];if(!i)return;if(!["text/csv","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(i.type)){a.error(s("teacher.invalidFileType"));return}S(!0);const r=new FormData;r.append("file",i);try{const N=(await E.import(r)).data.data;a.success(s("teacher.importSuccessDetails",{quizzes:N.quizzes_imported,questions:N.questions_imported,skipped:N.rows_skipped})),f.invalidateQueries({queryKey:["admin-quizzes"]})}catch(x){a.error(((n=(p=x.response)==null?void 0:p.data)==null?void 0:n.message)||s("teacher.importError"))}finally{S(!1),h.current&&(h.current.value="")}},$=async()=>{A(!0);try{const t=await E.export(),i=t.headers["content-type"];if(i&&i.includes("application/json")){const n=await t.data.text(),x=JSON.parse(n);throw new Error(x.message||"Export returned JSON instead of file")}const c=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=c;const u=t.headers["content-disposition"];let p=`quizzes-${new Date().toISOString().split("T")[0]}.csv`;if(u){const n=u.match(/filename="?(.+)"?/i);n&&(p=n[1])}r.setAttribute("download",p),document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(c),a.success(s("teacher.exportSuccess"))}catch(t){console.error("Export error:",t),a.error(t.message||s("teacher.exportError"))}finally{A(!1)}};return _?e.jsx(C,{children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:s("admin.quizzes.title")}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(k,{className:"h-10 w-full"}),e.jsx(k,{className:"h-96 w-full"})]})]})}):B?e.jsx(C,{children:e.jsxs("div",{children:[e.jsx(pe,{variant:"destructive",children:e.jsx(he,{children:s("admin.quizzes.error")})}),e.jsx(d,{onClick:()=>U(),className:"mt-4",children:s("common.retry")})]})}):e.jsx(C,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:s("admin.quizzes.title")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{variant:"outline",onClick:()=>{var t;return(t=h.current)==null?void 0:t.click()},disabled:D,children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),s(D?"common.uploading":"teacher.import")]}),e.jsxs(d,{variant:"outline",onClick:$,disabled:T,children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),s(T?"common.loading":"teacher.export")]}),e.jsxs(d,{onClick:()=>b("/teacher/quizzes/create"),children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),s("admin.quizzes.createQuiz")]})]})]}),e.jsx("input",{ref:h,type:"file",accept:".csv,.xlsx,.xls",onChange:K,className:"hidden"}),e.jsx(se,{languageId:j,level:g,search:z,languages:R,onChange:H}),e.jsx(ee,{children:e.jsxs(te,{children:[e.jsx(ie,{children:e.jsxs(q,{children:[e.jsx(m,{children:s("admin.quizzes.title")}),e.jsx(m,{children:s("admin.quizzes.language")}),e.jsx(m,{children:s("admin.quizzes.level")}),e.jsx(m,{children:s("admin.quizzes.questions")}),e.jsx(m,{children:s("admin.quizzes.active")}),e.jsx(m,{className:"text-right",children:s("admin.quizzes.actions")})]})}),e.jsx(ae,{children:w&&w.length>0?w.map(t=>{var i,c;return e.jsxs(q,{children:[e.jsx(l,{className:"font-medium",children:((i=t.title)==null?void 0:i.en)||t.title||s("quiz.untitled")}),e.jsx(l,{children:((c=t.language)==null?void 0:c.name)||"-"}),e.jsx(l,{children:e.jsx(xe,{variant:"outline",children:t.level})}),e.jsx(l,{children:t.questions_count||0}),e.jsx(l,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{checked:t.is_active??!1,onCheckedChange:()=>P(t)}),e.jsx("span",{className:"text-sm flex items-center gap-1",children:t.is_active?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-4 h-4"}),s("common.active")]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-4 h-4"}),s("common.inactive")]})})]})}),e.jsx(l,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>b(`/teacher/quizzes/${t.id}/edit`),children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>y(t),children:e.jsx(qe,{className:"w-4 h-4 text-red-600"})})]})})]},t.id)}):e.jsx(q,{children:e.jsx(l,{colSpan:6,className:"text-center py-8 text-gray-500",children:s("admin.quizzes.noQuizzes")})})})]})}),e.jsx(re,{open:!!v,onOpenChange:()=>y(null),children:e.jsxs(ne,{children:[e.jsxs(oe,{children:[e.jsx(le,{children:s("admin.quizzes.deleteConfirmTitle")}),e.jsx(ce,{children:s("admin.quizzes.deleteConfirmMessage")})]}),e.jsxs(de,{children:[e.jsx(me,{children:s("common.cancel")}),e.jsx(ue,{onClick:J,className:"bg-red-600 hover:bg-red-700",children:s("common.delete")})]})]})})]})})};export{us as ManageQuizzes,us as default};
