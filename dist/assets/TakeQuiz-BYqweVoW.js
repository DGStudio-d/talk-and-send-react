import{r as a,j as e,b as N,d as F,u as H,a as V,J as w}from"./index-BbbxppCW.js";import{C as v,a as I}from"./card-zbz7qCJr.js";import{B as h}from"./button-CIKh5vM4.js";import{S as f}from"./skeleton-TmsLY8PM.js";import{A as W,a as G,b as K,c as X,d as Y,e as Z,f as ee,g as te}from"./alert-dialog-BMVIkOSi.js";import{Q as se}from"./QuizQuestionDisplay-D6_UEnJi.js";import{u as L}from"./useTranslation-CC21zoU6.js";import{C as ie}from"./circle-alert-BdtuzKfq.js";import{C as re}from"./clock-BfSKEJpp.js";import{a as ae,b as ne}from"./useQuizAttempts-BC2VXcJH.js";import{M as S}from"./MainLayout-BALAcp-P.js";import{A as oe}from"./arrow-left-DgJDJzNN.js";import{S as le}from"./send-BwfJKk8x.js";import{A as ce}from"./arrow-right-D82eKP1c.js";import"./index-BtDOLYso.js";import"./index-CrWK1cfR.js";import"./Combination-dIoxx1Zk.js";import"./circle-check-Dsibk6Jb.js";import"./circle-x-CAdb3oZW.js";import"./useQuery-BIga7gMY.js";import"./useMutation-C5-Yw93X.js";import"./useInfiniteQuery-B5ANnVOJ.js";import"./useResponsiveLogo-oJ2RCBfb.js";import"./LanguageSwitcher-CFBw11ZH.js";import"./index-CNkEgW_D.js";import"./index-CKCShlFX.js";import"./check-BhLxpiQA.js";import"./Logo-qwv8thKT.js";import"./user-CgQqfPiY.js";import"./log-out-CEU61esy.js";import"./users-8lpkJKwV.js";import"./book-open-SIfqpxXT.js";const me=({durationMinutes:y,onTimeUp:x})=>{const{t:c}=L(),[t,j]=a.useState(y*60);a.useEffect(()=>{const n=setInterval(()=>{j(m=>m<=1?(clearInterval(n),x(),0):m-1)},1e3);return()=>clearInterval(n)},[x]);const r=n=>{const m=Math.floor(n/60),g=n%60;return`${m.toString().padStart(2,"0")}:${g.toString().padStart(2,"0")}`},s=t<=120;return e.jsx(v,{className:N("transition-colors",s&&"border-red-500 bg-red-50"),role:"timer","aria-live":"polite","aria-atomic":"true","aria-label":c("quiz.timerLabel",{time:r(t)}),children:e.jsxs(I,{className:"py-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[s?e.jsx(ie,{className:"w-5 h-5 text-red-600","aria-hidden":"true"}):e.jsx(re,{className:"w-5 h-5 text-primary-600","aria-hidden":"true"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:N("text-2xl font-bold tabular-nums",s?"text-red-600":"text-primary-600"),"aria-hidden":"true",children:r(t)}),e.jsx("p",{className:N("text-xs",s?"text-red-600":"text-muted-foreground"),children:c("quiz.timeRemaining")})]})]}),s&&e.jsx("span",{className:"sr-only",role:"alert",children:c("quiz.lowTimeWarning",{time:r(t)})})]})})},$e=()=>{var D;const{quizId:y,attemptId:x}=F(),c=H(),{t}=L(),{locale:j}=V(),r=parseInt(x||"0"),{data:s,isLoading:n,isError:m}=ae(r),g=ne(),[o,A]=a.useState(0),[u,T]=a.useState({}),[E,b]=a.useState(!1),[z,C]=a.useState(!1);a.useEffect(()=>{const i=l=>{!z&&Object.keys(u).length>0&&(l.preventDefault(),l.returnValue="")};return window.addEventListener("beforeunload",i),()=>window.removeEventListener("beforeunload",i)},[u,z]);const d=((D=s==null?void 0:s.quiz)==null?void 0:D.questions)||[],p=d[o],O=i=>{p&&T(l=>({...l,[p.id]:i}))},M=()=>{o>0&&A(i=>i-1)},R=()=>{o<d.length-1&&A(i=>i+1)},_=()=>{b(!0)},Q=async()=>{var i,l;C(!0),b(!1);try{const q=Object.entries(u).map(([$,J])=>({quiz_question_id:parseInt($),selected_option:J}));await g.mutateAsync({id:r,answers:q}),w.success(t("quiz.quizSubmitted")),c(`/attempts/${r}/results`)}catch(q){C(!1),w.error(((l=(i=q.response)==null?void 0:i.data)==null?void 0:l.message)||t("quiz.errorSubmittingQuiz"))}},B=a.useCallback(()=>{w.warning(t("quiz.timeUp")),Q()},[u,r]);if(n)return e.jsx(S,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(f,{className:"h-20 w-full"}),e.jsx(f,{className:"h-96 w-full"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(f,{className:"h-10 w-24"}),e.jsx(f,{className:"h-10 w-24"})]})]})});if(m||!s||!s.quiz)return e.jsx(S,{children:e.jsx(v,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-red-600",children:t("quiz.errorLoadingAttempt")}),e.jsx(h,{onClick:()=>c("/quizzes"),children:t("quiz.backToQuizzes")})]})})});const P=s.quiz.title[j]||s.quiz.title.en,U=o===d.length-1,k=Object.keys(u).length;return e.jsx(S,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(v,{children:e.jsx(I,{className:"py-4",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:P}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t("quiz.questionProgress",{current:o+1,total:d.length})," â€¢ ",t("quiz.answered"),": ",k,"/",d.length]})]}),s.quiz.duration_minutes&&e.jsx(me,{durationMinutes:s.quiz.duration_minutes,onTimeUp:B})]})})}),p&&e.jsx(se,{question:p,questionNumber:o+1,selectedOption:u[p.id],onSelectOption:O}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs(h,{variant:"outline",onClick:M,disabled:o===0,children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),t("quiz.previous")]}),U?e.jsxs(h,{onClick:_,className:"bg-primary-500 hover:bg-primary-600",disabled:z,children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),t("quiz.submitQuiz")]}):e.jsxs(h,{onClick:R,className:"bg-primary-500 hover:bg-primary-600",children:[t("quiz.next"),e.jsx(ce,{className:"w-4 h-4 ml-2"})]})]}),e.jsx(W,{open:E,onOpenChange:b,children:e.jsxs(G,{children:[e.jsxs(K,{children:[e.jsx(X,{children:t("quiz.confirmSubmit")}),e.jsx(Y,{children:t("quiz.confirmSubmitMessage",{answered:k,total:d.length})})]}),e.jsxs(Z,{children:[e.jsx(ee,{children:t("common.cancel")}),e.jsx(te,{onClick:Q,children:t("quiz.submit")})]})]})})]})})};export{$e as TakeQuiz,$e as default};
