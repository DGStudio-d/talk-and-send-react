import{c as je,n as d,U as N,o as y,r as v,j as e,J as b,e as ue,p as pe,b as B,R as ge}from"./index-BbbxppCW.js";import{u as ve,a as fe,b as be,c as Ne,d as ye,e as Se}from"./useUsers-D_igF0_M.js";import{B as C,b as we}from"./button-CIKh5vM4.js";import{I as U}from"./input-Dl5UbgYB.js";import{S as k,a as M,b as L,c as R,d as o}from"./select-Djc9bocP.js";import{T as Ce,a as Ue,b as q,c as V,d as Ae,e as D}from"./table-D7A3MFyr.js";import{A as Pe,a as Te,b as De,c as Fe,d as ke,e as Me,f as Le,g as Re}from"./alert-dialog-BMVIkOSi.js";import{S as X}from"./skeleton-TmsLY8PM.js";import{A as Ee,a as Ie}from"./alert-Ckbomrq-.js";import{B as Ve}from"./badge-B57fkYpB.js";import{C as _e}from"./card-zbz7qCJr.js";import{u as Y}from"./index.esm-CYaOjpFt.js";import{o as Z,s as F,n as _,t as ee}from"./zod-BufzoQnV.js";import{D as se,a as ae,b as le,c as re,e as ie}from"./dialog-B0Pn59SX.js";import{L as m}from"./label-Byme5i-Q.js";import{u as J}from"./useTranslation-CC21zoU6.js";import{M as G}from"./MainLayout-BALAcp-P.js";import{S as Be}from"./switch-D6hUCL8N.js";import{C as Oe}from"./LanguageSwitcher-CFBw11ZH.js";import{U as ze}from"./user-plus-DJQTjPpY.js";import{S as He}from"./search-D3snqzKk.js";import{P as Qe}from"./pencil-yIgd1Bop.js";import{T as $e}from"./trash-2-CaDzUwOu.js";import"./useQuery-BIga7gMY.js";import"./useMutation-C5-Yw93X.js";import"./index-CNkEgW_D.js";import"./Combination-dIoxx1Zk.js";import"./index-CrWK1cfR.js";import"./index-wpz6Hu0Z.js";import"./check-BhLxpiQA.js";import"./index-BtDOLYso.js";import"./useResponsiveLogo-oJ2RCBfb.js";import"./Logo-qwv8thKT.js";import"./user-CgQqfPiY.js";import"./log-out-CEU61esy.js";import"./users-8lpkJKwV.js";import"./book-open-SIfqpxXT.js";import"./index-CKCShlFX.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=je("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Ge=Z({name:F().min(2,"Name must be at least 2 characters"),email:F().email("Invalid email address"),phone:F().min(10,"Phone must be at least 10 characters"),role:_(d),level:_(N),locale:_(y)}),Je=({user:s,open:t,onClose:l})=>{const{t:r}=J(),j=ve(),h=fe(),{register:c,handleSubmit:S,formState:{errors:n},setValue:f,watch:w,reset:u}=Y({resolver:ee(Ge),defaultValues:{name:s.name,email:s.email,phone:s.phone,role:s.role,level:s.level,locale:s.locale}}),A=w("role"),P=w("level"),E=w("locale");v.useEffect(()=>{s&&u({name:s.name,email:s.email,phone:s.phone,role:s.role,level:s.level,locale:s.locale})},[s,u]);const x=async i=>{var T,I,p;try{await j.mutateAsync({id:s.id,data:{name:i.name,email:i.email,phone:i.phone,level:i.level,locale:i.locale}}),i.role!==s.role&&await h.mutateAsync({id:s.id,role:i.role}),b.success(r("admin.users.updateSuccess")),l()}catch(z){const $=((I=(T=z.response)==null?void 0:T.data)==null?void 0:I.message)||r("admin.users.updateError");b.error($),console.error("Update error:",(p=z.response)==null?void 0:p.data)}};return e.jsx(se,{open:t,onOpenChange:l,children:e.jsxs(ae,{className:"sm:max-w-[500px]",children:[e.jsx(le,{children:e.jsx(re,{children:r("admin.users.editUser")})}),e.jsxs("form",{onSubmit:S(x),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"name",children:r("admin.users.name")}),e.jsx(U,{id:"name",...c("name"),className:n.name?"border-red-500":"","aria-invalid":!!n.name,"aria-describedby":n.name?"name-error":void 0}),n.name&&e.jsx("p",{id:"name-error",className:"text-sm text-red-500 mt-1",role:"alert",children:n.name.message})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"email",children:r("admin.users.email")}),e.jsx(U,{id:"email",type:"email",...c("email"),className:n.email?"border-red-500":"","aria-invalid":!!n.email,"aria-describedby":n.email?"email-error":void 0}),n.email&&e.jsx("p",{id:"email-error",className:"text-sm text-red-500 mt-1",role:"alert",children:n.email.message})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"phone",children:r("admin.users.phone")}),e.jsx(U,{id:"phone",...c("phone"),className:n.phone?"border-red-500":"","aria-invalid":!!n.phone,"aria-describedby":n.phone?"phone-error":void 0}),n.phone&&e.jsx("p",{id:"phone-error",className:"text-sm text-red-500 mt-1",role:"alert",children:n.phone.message})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"role",children:r("admin.users.role")}),e.jsxs(k,{value:A,onValueChange:i=>f("role",i),children:[e.jsx(M,{id:"role","aria-label":r("admin.users.role"),children:e.jsx(L,{})}),e.jsxs(R,{children:[e.jsx(o,{value:d.Admin,children:r("roles.admin")}),e.jsx(o,{value:d.Teacher,children:r("roles.teacher")}),e.jsx(o,{value:d.Student,children:r("roles.student")})]})]}),n.role&&e.jsx("p",{id:"role-error",className:"text-sm text-red-500 mt-1",role:"alert",children:n.role.message})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"level",children:r("admin.users.level")}),e.jsxs(k,{value:P,onValueChange:i=>f("level",i),children:[e.jsx(M,{id:"level","aria-label":r("admin.users.level"),children:e.jsx(L,{})}),e.jsxs(R,{children:[e.jsx(o,{value:N.Beginner,children:r("levels.beginner")}),e.jsx(o,{value:N.Intermediate,children:r("levels.intermediate")}),e.jsx(o,{value:N.Advanced,children:r("levels.advanced")})]})]}),n.level&&e.jsx("p",{id:"level-error",className:"text-sm text-red-500 mt-1",role:"alert",children:n.level.message})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"locale",children:r("admin.users.locale")}),e.jsxs(k,{value:E,onValueChange:i=>f("locale",i),children:[e.jsx(M,{id:"locale","aria-label":r("admin.users.locale"),children:e.jsx(L,{})}),e.jsxs(R,{children:[e.jsx(o,{value:y.English,children:r("languages.english")}),e.jsx(o,{value:y.Arabic,children:r("languages.arabic")}),e.jsx(o,{value:y.Spanish,children:r("languages.spanish")})]})]}),n.locale&&e.jsx("p",{id:"locale-error",className:"text-sm text-red-500 mt-1",role:"alert",children:n.locale.message})]}),e.jsxs(ie,{children:[e.jsx(C,{type:"button",variant:"outline",onClick:l,children:r("common.cancel")}),e.jsx(C,{type:"submit",disabled:j.isPending||h.isPending,children:j.isPending||h.isPending?r("common.saving"):r("common.save")})]})]})]})})},Ke=Z({name:F().min(2,"Name must be at least 2 characters"),email:F().email("Invalid email address"),phone:F().min(10,"Phone must be at least 10 characters"),password:F().min(8,"Password must be at least 8 characters"),role:_(d),level:_(N),locale:_(y)}),We=({open:s,onClose:t})=>{const{t:l}=J(),r=ue(),{register:j,handleSubmit:h,formState:{errors:c,isSubmitting:S},setValue:n,watch:f,reset:w}=Y({resolver:ee(Ke),defaultValues:{role:d.Student,level:N.Beginner,locale:y.English}}),u=f("role"),A=f("level"),P=f("locale"),E=async x=>{var i,T;try{await pe.register(x),b.success(l("admin.users.createSuccess")),r.invalidateQueries({queryKey:["users"]}),w(),t()}catch(I){const p=((T=(i=I.response)==null?void 0:i.data)==null?void 0:T.message)||l("admin.users.createError");b.error(p)}};return e.jsx(se,{open:s,onOpenChange:t,children:e.jsxs(ae,{className:"sm:max-w-[500px]",children:[e.jsx(le,{children:e.jsx(re,{children:l("admin.users.createUser")})}),e.jsxs("form",{onSubmit:h(E),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"name",children:l("admin.users.name")}),e.jsx(U,{id:"name",...j("name"),className:c.name?"border-red-500":""}),c.name&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.name.message})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"email",children:l("admin.users.email")}),e.jsx(U,{id:"email",type:"email",...j("email"),className:c.email?"border-red-500":""}),c.email&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.email.message})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"phone",children:l("admin.users.phone")}),e.jsx(U,{id:"phone",...j("phone"),className:c.phone?"border-red-500":""}),c.phone&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.phone.message})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"password",children:l("admin.users.password")}),e.jsx(U,{id:"password",type:"password",...j("password"),className:c.password?"border-red-500":""}),c.password&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.password.message})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"role",children:l("admin.users.role")}),e.jsxs(k,{value:u,onValueChange:x=>n("role",x),children:[e.jsx(M,{id:"role",children:e.jsx(L,{})}),e.jsxs(R,{children:[e.jsx(o,{value:d.Admin,children:l("roles.admin")}),e.jsx(o,{value:d.Teacher,children:l("roles.teacher")}),e.jsx(o,{value:d.Student,children:l("roles.student")})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"level",children:l("admin.users.level")}),e.jsxs(k,{value:A,onValueChange:x=>n("level",x),children:[e.jsx(M,{id:"level",children:e.jsx(L,{})}),e.jsxs(R,{children:[e.jsx(o,{value:N.Beginner,children:l("levels.beginner")}),e.jsx(o,{value:N.Intermediate,children:l("levels.intermediate")}),e.jsx(o,{value:N.Advanced,children:l("levels.advanced")})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"locale",children:l("admin.users.locale")}),e.jsxs(k,{value:P,onValueChange:x=>n("locale",x),children:[e.jsx(M,{id:"locale",children:e.jsx(L,{})}),e.jsxs(R,{children:[e.jsx(o,{value:y.English,children:l("languages.english")}),e.jsx(o,{value:y.Arabic,children:l("languages.arabic")}),e.jsx(o,{value:y.Spanish,children:l("languages.spanish")})]})]})]}),e.jsxs(ie,{children:[e.jsx(C,{type:"button",variant:"outline",onClick:t,children:l("common.cancel")}),e.jsx(C,{type:"submit",disabled:S,children:l(S?"common.creating":"common.create")})]})]})]})})},ne=({className:s,...t})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:B("mx-auto flex w-full justify-center",s),...t});ne.displayName="Pagination";const te=v.forwardRef(({className:s,...t},l)=>e.jsx("ul",{ref:l,className:B("flex flex-row items-center gap-1",s),...t}));te.displayName="PaginationContent";const O=v.forwardRef(({className:s,...t},l)=>e.jsx("li",{ref:l,className:B("",s),...t}));O.displayName="PaginationItem";const Q=({className:s,isActive:t,size:l="icon",...r})=>e.jsx("a",{"aria-current":t?"page":void 0,className:B(we({variant:t?"outline":"ghost",size:l}),s),...r});Q.displayName="PaginationLink";const oe=({className:s,...t})=>e.jsxs(Q,{"aria-label":"Go to previous page",size:"default",className:B("gap-1 pl-2.5",s),...t,children:[e.jsx(qe,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]});oe.displayName="PaginationPrevious";const ce=({className:s,...t})=>e.jsxs(Q,{"aria-label":"Go to next page",size:"default",className:B("gap-1 pr-2.5",s),...t,children:[e.jsx("span",{children:"Next"}),e.jsx(Oe,{className:"h-4 w-4"})]});ce.displayName="PaginationNext";const Rs=()=>{const{t:s}=J(),[t,l]=v.useState("all"),[r,j]=v.useState(""),[h,c]=v.useState(null),[S,n]=v.useState(null),[f,w]=v.useState(!1),[u,A]=v.useState(1),[P,E]=v.useState(null),x={...t!=="all"&&{role:t},...r&&{search:r},page:u,per_page:10},{data:i,isLoading:T,isError:I,refetch:p}=be(x),z=Ne(),$=ye(),de=Se(),me=async()=>{if(h)try{await z.mutateAsync(h.id),b.success(s("admin.users.deleteSuccess")),c(null),await p()}catch{b.error(s("admin.users.deleteError"))}},he=async a=>{var g,H,K;if(P!==a.id){E(a.id);try{a.is_active?(await de.mutateAsync(a.id),b.success(s("admin.users.deactivateSuccess")),p()):(await $.mutateAsync(a.id),b.success(s("admin.users.activateSuccess"))),await p()}catch(W){const xe=((H=(g=W.response)==null?void 0:g.data)==null?void 0:H.message)||s("admin.users.toggleError");b.error(xe),console.error("Toggle active error:",(K=W.response)==null?void 0:K.data),await p()}finally{E(null)}}};return T?e.jsx(G,{children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:s("admin.users.title")}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(X,{className:"h-10 w-full"}),e.jsx(X,{className:"h-96 w-full"})]})]})}):I?e.jsx(G,{children:e.jsxs("div",{children:[e.jsx(Ee,{variant:"destructive",children:e.jsx(Ie,{children:s("admin.users.error")})}),e.jsx(C,{onClick:()=>p(),className:"mt-4",children:s("common.retry")})]})}):e.jsx(G,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:s("admin.users.title")}),e.jsxs(C,{onClick:()=>w(!0),children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),s("admin.users.createUser")]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(He,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(U,{placeholder:s("admin.users.searchPlaceholder"),value:r,onChange:a=>j(a.target.value),className:"pl-10"})]}),e.jsxs(k,{value:t,onValueChange:l,children:[e.jsx(M,{className:"w-full md:w-48",children:e.jsx(L,{placeholder:s("admin.users.filterByRole")})}),e.jsxs(R,{children:[e.jsx(o,{value:"all",children:s("admin.users.allRoles")}),e.jsx(o,{value:d.Admin,children:s("roles.admin")}),e.jsx(o,{value:d.Teacher,children:s("roles.teacher")}),e.jsx(o,{value:d.Student,children:s("roles.student")})]})]})]}),e.jsx(_e,{children:e.jsxs(Ce,{children:[e.jsx(Ue,{children:e.jsxs(q,{children:[e.jsx(V,{children:s("admin.users.name")}),e.jsx(V,{children:s("admin.users.email")}),e.jsx(V,{children:s("admin.users.role")}),e.jsx(V,{children:s("admin.users.level")}),e.jsx(V,{children:s("admin.users.status")}),e.jsx(V,{className:"text-right",children:s("admin.users.actions")})]})}),e.jsx(Ae,{children:i!=null&&i.users&&i.users.length>0?i.users.map(a=>e.jsxs(q,{children:[e.jsx(D,{className:"font-medium",children:a.name}),e.jsx(D,{children:a.email}),e.jsx(D,{children:e.jsx(Ve,{variant:a.role===d.Admin?"destructive":a.role===d.Teacher?"default":"secondary",children:s(`roles.${a.role}`)})}),e.jsx(D,{children:s(`levels.${a.level}`)}),e.jsx(D,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{checked:a.is_active??!1,onCheckedChange:()=>he(a),disabled:P===a.id}),e.jsx("span",{className:"text-sm",children:P===a.id?e.jsx("span",{className:"text-gray-400",children:s("common.loading")}):a.is_active?s("admin.users.active"):s("admin.users.inactive")})]})}),e.jsx(D,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(C,{variant:"outline",size:"sm",onClick:()=>n(a),children:e.jsx(Qe,{className:"w-4 h-4"})}),e.jsx(C,{variant:"outline",size:"sm",onClick:()=>c(a),children:e.jsx($e,{className:"w-4 h-4 text-red-600"})})]})})]},a.id)):e.jsx(q,{children:e.jsx(D,{colSpan:6,className:"text-center py-8 text-gray-500",children:s("admin.users.noUsers")})})})]})}),(i==null?void 0:i.pagination)&&i.pagination.total>i.pagination.per_page&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx(ne,{children:e.jsxs(te,{children:[e.jsx(O,{children:e.jsx(oe,{onClick:()=>A(a=>Math.max(1,a-1)),className:u===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:i.pagination.last_page},(a,g)=>g+1).filter(a=>{const g=Math.abs(a-u);return g===0||g===1||a===1||a===i.pagination.last_page}).map((a,g,H)=>e.jsxs(ge.Fragment,{children:[g>0&&H[g-1]!==a-1&&e.jsx(O,{children:e.jsx("span",{className:"px-4",children:"..."})}),e.jsx(O,{children:e.jsx(Q,{onClick:()=>A(a),isActive:u===a,className:"cursor-pointer",children:a})})]},a)),e.jsx(O,{children:e.jsx(ce,{onClick:()=>A(a=>Math.min(i.pagination.last_page,a+1)),className:u===i.pagination.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})}),e.jsx(Pe,{open:!!h,onOpenChange:()=>c(null),children:e.jsxs(Te,{children:[e.jsxs(De,{children:[e.jsx(Fe,{children:s("admin.users.deleteConfirmTitle")}),e.jsx(ke,{children:s("admin.users.deleteConfirmMessage",{name:h==null?void 0:h.name})})]}),e.jsxs(Me,{children:[e.jsx(Le,{children:s("common.cancel")}),e.jsx(Re,{onClick:me,className:"bg-red-600 hover:bg-red-700",children:s("common.delete")})]})]})}),e.jsx(We,{open:f,onClose:()=>w(!1)}),S&&e.jsx(Je,{user:S,open:!!S,onClose:()=>n(null)})]})})};export{Rs as ManageUsers,Rs as default};
