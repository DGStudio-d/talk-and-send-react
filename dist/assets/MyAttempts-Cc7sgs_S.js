import{c as _,u as D,a as P,r as l,j as e}from"./index-BbbxppCW.js";import{C as n}from"./card-zbz7qCJr.js";import{B as p}from"./button-CIKh5vM4.js";import{L as A}from"./label-Byme5i-Q.js";import{S,a as w,b as F,c as M,d as o}from"./select-Djc9bocP.js";import{S as d}from"./skeleton-TmsLY8PM.js";import{A as R}from"./AttemptCard-Q6WAcIqk.js";import{c as V}from"./useQuizAttempts-BC2VXcJH.js";import{M as h}from"./MainLayout-BALAcp-P.js";import{u as O}from"./useTranslation-CC21zoU6.js";import{L as T}from"./loader-circle-BTqhVs_v.js";import{B as C}from"./book-open-SIfqpxXT.js";import"./index-CNkEgW_D.js";import"./Combination-dIoxx1Zk.js";import"./index-CrWK1cfR.js";import"./index-wpz6Hu0Z.js";import"./check-BhLxpiQA.js";import"./badge-B57fkYpB.js";import"./circle-check-Dsibk6Jb.js";import"./circle-x-CAdb3oZW.js";import"./calendar-BGtI_0eA.js";import"./target-Dx8SBibj.js";import"./useQuery-BIga7gMY.js";import"./useMutation-C5-Yw93X.js";import"./useInfiniteQuery-B5ANnVOJ.js";import"./useResponsiveLogo-oJ2RCBfb.js";import"./LanguageSwitcher-CFBw11ZH.js";import"./index-CKCShlFX.js";import"./Logo-qwv8thKT.js";import"./user-CgQqfPiY.js";import"./log-out-CEU61esy.js";import"./users-8lpkJKwV.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=_("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),ve=()=>{const L=D(),{t:i}=O(),{locale:f}=P(),[a,j]=l.useState(),[m,g]=l.useState("all"),{data:c,isLoading:Q,isError:k,fetchNextPage:z,hasNextPage:N,isFetchingNextPage:u,refetch:B}=V(),x=l.useRef(null),r=l.useMemo(()=>c!=null&&c.pages?c.pages.flatMap(s=>s.attempts||[]):[],[c]);l.useEffect(()=>{if(!x.current||!N||u)return;const s=new IntersectionObserver(t=>{t[0].isIntersecting&&z()},{threshold:.1});return s.observe(x.current),()=>s.disconnect()},[z,N,u]),console.log("attempts",r);const E=l.useMemo(()=>{if(!r||!Array.isArray(r))return[];const s=new Map;return r.forEach(t=>{var q,v;if(t.quiz&&!s.has(t.quiz.id)){const b=((q=t.quiz.title)==null?void 0:q[f])||((v=t.quiz.title)==null?void 0:v.en)||i("quiz.deletedQuiz"),I=!t.quiz||t.quiz.is_deleted;s.set(t.quiz.id,{id:t.quiz.id,title:I?`${b} (${i("quiz.deleted")})`:b})}}),Array.from(s.values())},[r,f,i]),y=l.useMemo(()=>!r||!Array.isArray(r)?[]:r.filter(s=>!(a&&s.quiz_id!==a||m==="passed"&&!s.is_passed||m==="failed"&&s.is_passed)),[r,a,m]);return Q?e.jsx(h,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:i("quiz.myAttempts")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(d,{className:"h-10 w-full"}),e.jsx(d,{className:"h-10 w-full"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3,4,5,6].map(s=>e.jsxs(n,{className:"p-6",children:[e.jsx(d,{className:"h-6 w-3/4 mb-4"}),e.jsx(d,{className:"h-4 w-1/2 mb-2"}),e.jsx(d,{className:"h-4 w-2/3"})]},s))})]})}):k?e.jsx(h,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:i("quiz.myAttempts")}),e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-red-600",children:i("quiz.errorLoadingAttempts")}),e.jsx(p,{onClick:()=>B(),children:i("common.retry")})]})})]})}):e.jsx(h,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:i("quiz.myAttempts")}),r&&r.length>0&&e.jsxs(n,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx($,{className:"w-5 h-5 text-primary-600"}),e.jsx("h2",{className:"font-semibold",children:i("quiz.filters")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"quiz-filter",children:i("quiz.filterByQuiz")}),e.jsxs(S,{value:(a==null?void 0:a.toString())||"all",onValueChange:s=>j(s==="all"?void 0:parseInt(s)),children:[e.jsx(w,{id:"quiz-filter",children:e.jsx(F,{placeholder:i("quiz.allQuizzes")})}),e.jsxs(M,{children:[e.jsx(o,{value:"all",children:i("quiz.allQuizzes")}),E.map(s=>e.jsx(o,{value:s.id.toString(),children:s.title},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"status-filter",children:i("quiz.filterByStatus")}),e.jsxs(S,{value:m,onValueChange:s=>g(s),children:[e.jsx(w,{id:"status-filter",children:e.jsx(F,{})}),e.jsxs(M,{children:[e.jsx(o,{value:"all",children:i("quiz.allStatuses")}),e.jsx(o,{value:"passed",children:i("quiz.passed")}),e.jsx(o,{value:"failed",children:i("quiz.failed")})]})]})]})]})]}),y.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map(s=>e.jsx(R,{attempt:s},s.id))}),e.jsx("div",{ref:x,className:"flex justify-center py-8",children:u&&e.jsx(T,{className:"w-8 h-8 animate-spin text-primary-500"})})]}):r&&r.length>0?e.jsx(n,{className:"p-12",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(C,{className:"w-16 h-16 mx-auto text-gray-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-700",children:i("quiz.noAttemptsMatchFilters")}),e.jsx("p",{className:"text-gray-500",children:i("quiz.tryDifferentFilters")}),e.jsx(p,{variant:"outline",onClick:()=>{j(void 0),g("all")},children:i("quiz.clearFilters")})]})}):e.jsx(n,{className:"p-12",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(C,{className:"w-16 h-16 mx-auto text-gray-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-700",children:i("quiz.noAttempts")}),e.jsx("p",{className:"text-gray-500",children:i("quiz.noAttemptsDescription")}),e.jsx(p,{onClick:()=>L("/quizzes"),className:"bg-primary-500 hover:bg-primary-600",children:i("quiz.browseQuizzes")})]})})]})})};export{ve as MyAttempts,ve as default};
