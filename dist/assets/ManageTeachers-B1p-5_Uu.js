import{e as Q,r as c,n as L,j as e,t as E,J as n}from"./index-BbbxppCW.js";import{b as P}from"./useUsers-D_igF0_M.js";import{B as f}from"./button-CIKh5vM4.js";import{I as q}from"./input-Dl5UbgYB.js";import{C as M}from"./card-zbz7qCJr.js";import{T as z,a as H,b as U,c as g,d as K,e as p}from"./table-D7A3MFyr.js";import{S as k}from"./skeleton-TmsLY8PM.js";import{A as R,a as J}from"./alert-Ckbomrq-.js";import{S as O}from"./switch-D6hUCL8N.js";import{M as _}from"./MainLayout-BALAcp-P.js";import{D as V,a as $,b as W,c as G,e as X}from"./dialog-B0Pn59SX.js";import{L as B}from"./label-Byme5i-Q.js";import{T as F}from"./textarea-BiZKJTtT.js";import{u as I}from"./useTranslation-CC21zoU6.js";import{U as Y}from"./upload-C3ONQcIS.js";import{a as Z,E as ee}from"./eye-DpgY7ATH.js";import{P as se}from"./pencil-yIgd1Bop.js";import"./useQuery-BIga7gMY.js";import"./useMutation-C5-Yw93X.js";import"./index-wpz6Hu0Z.js";import"./useResponsiveLogo-oJ2RCBfb.js";import"./LanguageSwitcher-CFBw11ZH.js";import"./index-CNkEgW_D.js";import"./Combination-dIoxx1Zk.js";import"./index-CKCShlFX.js";import"./index-CrWK1cfR.js";import"./check-BhLxpiQA.js";import"./Logo-qwv8thKT.js";import"./user-CgQqfPiY.js";import"./log-out-CEU61esy.js";import"./users-8lpkJKwV.js";import"./book-open-SIfqpxXT.js";import"./index-BtDOLYso.js";const Qe=()=>{const{t:s}=I(),x=Q(),[d,N]=c.useState(""),[i,m]=c.useState(null),[T,u]=c.useState(null),S={role:L.Teacher,...d&&{search:d}},{data:l,isLoading:w,isError:b,refetch:h}=P(S),C=async a=>{try{await E.adminToggleVisibility(a.id),n.success(s("admin.teachers.visibilityToggled")),h(),x.invalidateQueries({queryKey:["users"]})}catch{n.error(s("admin.teachers.visibilityError"))}},v=async(a,r)=>{if(r){if(!r.type.startsWith("image/")){n.error(s("admin.languages.invalidFileType"));return}if(r.size>2*1024*1024){n.error(s("admin.languages.fileTooLarge"));return}try{u(a);const t=new FormData;t.append("profile_image",r),await E.adminUploadImage(a,t),n.success(s("admin.teachers.imageUploadSuccess")),x.invalidateQueries({queryKey:["users"]}),h()}catch{n.error(s("admin.teachers.imageUploadError"))}finally{u(null)}}},y=async(a,r)=>{try{await E.adminUpdateProfile(a.id,r),n.success(s("admin.teachers.profileUpdateSuccess")),x.invalidateQueries({queryKey:["users"]}),m(null)}catch{n.error(s("admin.teachers.profileUpdateError"))}};return w?e.jsx(_,{children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:s("admin.teachers.title")}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(k,{className:"h-10 w-full"}),e.jsx(k,{className:"h-96 w-full"})]})]})}):b?e.jsx(_,{children:e.jsxs("div",{children:[e.jsx(R,{variant:"destructive",children:e.jsx(J,{children:s("admin.teachers.error")})}),e.jsx(f,{onClick:()=>h(),className:"mt-4",children:s("common.retry")})]})}):e.jsx(_,{children:e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsx("h1",{className:"text-3xl font-bold",children:s("admin.teachers.title")})}),e.jsx("div",{className:"mb-6",children:e.jsx(q,{placeholder:s("admin.teachers.searchPlaceholder"),value:d,onChange:a=>N(a.target.value)})}),e.jsx(M,{children:e.jsxs(z,{children:[e.jsx(H,{children:e.jsxs(U,{children:[e.jsx(g,{children:s("admin.teachers.image")}),e.jsx(g,{children:s("admin.teachers.name")}),e.jsx(g,{children:s("admin.teachers.email")}),e.jsx(g,{children:s("admin.teachers.visibility")}),e.jsx(g,{className:"text-right",children:s("admin.teachers.actions")})]})}),e.jsx(K,{children:l!=null&&l.users&&l.users.length>0?l.users.map(a=>{var r,t,j;return e.jsxs(U,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[(r=a.teacher_profile)!=null&&r.profile_image_url?e.jsx("img",{src:a.teacher_profile.profile_image_url,alt:a.name,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500 text-xs",children:a.name.charAt(0).toUpperCase()})}),e.jsxs("label",{htmlFor:`upload-${a.id}`,children:[e.jsx(f,{variant:"outline",size:"sm",disabled:T===a.id,asChild:!0,children:e.jsx("span",{className:"cursor-pointer",children:e.jsx(Y,{className:"w-4 h-4"})})}),e.jsx("input",{id:`upload-${a.id}`,type:"file",accept:"image/*",className:"hidden",onChange:o=>{var D;const A=(D=o.target.files)==null?void 0:D[0];A&&v(a.id,A)}})]})]})}),e.jsx(p,{className:"font-medium",children:a.name}),e.jsx(p,{children:a.email}),e.jsx(p,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{checked:((t=a.teacher_profile)==null?void 0:t.is_visible)??!1,onCheckedChange:()=>C(a)}),e.jsx("span",{className:"text-sm flex items-center gap-1",children:(j=a.teacher_profile)!=null&&j.is_visible?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4"}),s("admin.teachers.public")]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4"}),s("admin.teachers.hidden")]})})]})}),e.jsx(p,{className:"text-right",children:e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>m(a),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),s("admin.teachers.editBio")]})})]},a.id)}):e.jsx(U,{children:e.jsx(p,{colSpan:5,className:"text-center py-8 text-gray-500",children:s("admin.teachers.noTeachers")})})})]})}),i&&e.jsx(ae,{teacher:i,open:!!i,onClose:()=>m(null),onSave:y})]})})},ae=({teacher:s,open:x,onClose:d,onSave:N})=>{var v,y,a,r,t,j;const{t:i}=I(),[m,T]=c.useState(((y=(v=s.teacher_profile)==null?void 0:v.bio)==null?void 0:y.en)||""),[u,S]=c.useState(((r=(a=s.teacher_profile)==null?void 0:a.bio)==null?void 0:r.ar)||""),[l,w]=c.useState(((j=(t=s.teacher_profile)==null?void 0:t.bio)==null?void 0:j.es)||""),[b,h]=c.useState(!1),C=async()=>{h(!0),await N(s,{bio:{en:m,ar:u,es:l}}),h(!1)};return e.jsx(V,{open:x,onOpenChange:d,children:e.jsxs($,{className:"sm:max-w-[600px]",children:[e.jsx(W,{children:e.jsxs(G,{children:[i("admin.teachers.editBio")," - ",s.name]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(B,{htmlFor:"bio-en",children:i("teacher.bioEnglish")}),e.jsx(F,{id:"bio-en",value:m,onChange:o=>T(o.target.value),placeholder:i("teacher.enterBioEnglish"),rows:4})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"bio-ar",children:i("teacher.bioArabic")}),e.jsx(F,{id:"bio-ar",value:u,onChange:o=>S(o.target.value),placeholder:i("teacher.enterBioArabic"),rows:4,dir:"rtl"})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"bio-es",children:i("teacher.bioSpanish")}),e.jsx(F,{id:"bio-es",value:l,onChange:o=>w(o.target.value),placeholder:i("teacher.enterBioSpanish"),rows:4})]})]}),e.jsxs(X,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:d,children:i("common.cancel")}),e.jsx(f,{onClick:C,disabled:b,children:i(b?"common.saving":"common.save")})]})]})})};export{Qe as ManageTeachers,Qe as default};
